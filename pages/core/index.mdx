# Core overview

The core library handles the main underlying functionality in pure Typescript.

## Concepts

- framework agnostic
- with a fixed structure of components
- with observable properties exposed

## Structure

It is obligatory to start with `ThermalManager` and use its methods to build objects lower in the hierarchy.

`ThermalManager` -> `ThermalRegistry` -> `ThermalGroup` -> `ThermalFileinstance`

### Example

```javascript
// There must be only one instance of ThermalManager
const manager = new ThermalManager;

// Every context is defined in a registry
// A registry stores common attributes from groups and their instances
const registry = manager.addOrGetRegistry( "registry_id" );

// Group stands between a registry and instances
const group = registry.addOrGetGroup( "group_id" );

// Loading is performed using a registry
registry.loadOneFile({thermalUrl: "some_irl.lrc"}, group.id);


// The rendering itself depends on framework
// Below is the principle:

// You need to add listener to the registry
registry.loading.addListener( "mount_after_load", (value) => {

    // Whenever is the registry loading, unmount all instances
    if ( value === true ) {
        registry.groups.forEveryGroup(
            group => group.instances.forEveryInstance(
                instance => instance.unmountFromDOM()
            )
        );
    }

    // Whenever the registry finishes loading, mount instances somewhere
    if (value === false) {
        registry.groups.forEveryGroup(
            group => group.forEveryInstance(
                instance => {
                    instance.mountToDom( /* a HTMLDivElement */ );
                    instance.draw();
                }
            )
        );

    }

} );
```

### Functional Description

#### `ThermalManager`

- the main object that should live as singleton across all the application
- stores cache of loaded files as `ThermalFileSource`
- stores the `palette` option and propagates its config to all children
- creates and destroys instances of `ThermalRegistry`

#### `ThermalRegistry`

- a display context with files organised into groups
- handles loading of files
- stores and synchronises most of thermal display parameters

### `ThermalGroup`

- stores a group of files
- calculates some properties (eg. `minmax` of the entire group)
- synchronises `cursorPosition` across all child files

### `ThermalFileInstance`

- a single file
- based on `ThermalFileSource` that is cached in `ThermalManager`
- renders the thermogram in `<canvas>` element
- needs to be binded into a provided `HTMLDivElement` (a reference in React)
- handles all user interactions
- the internal drawing is written from scratch, without React & Frameworks

